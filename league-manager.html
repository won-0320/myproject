<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¦¬ê·¸ì „ ê²½ê¸° ê²°ê³¼ ê´€ë¦¬</title>
    <style>
        /* ì „ì—­ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ íƒ­ */
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab.active {
            background: white;
            color: #4a90e2;
            border-bottom: 3px solid #4a90e2;
        }

        .nav-tab:hover {
            background: #e9ecef;
            color: #4a90e2;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .control-group input,
        .control-group select {
            padding: 12px 15px;
            border: 2px solid #ced4da;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* íƒ­ ì»¨í…ì¸  */
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
        }

        /* ë°˜ë³„ ì…ë ¥ í¼ */
        .class-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .class-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a90e2;
        }

        .student-count {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        /* í•™ìƒ í…Œì´ë¸” */
        .students-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .students-table th,
        .students-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .students-table th {
            background: linear-gradient(135deg, #495057 0%, #343a40 100%);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .students-table td {
            vertical-align: middle;
        }

        .student-name-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .student-name-input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.1);
        }

        .game-select {
            width: 80px;
            padding: 6px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
        }

        .game-select.win {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .game-select.loss {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .game-select.absent {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .total-points {
            font-weight: 700;
            font-size: 1.1rem;
            color: #4a90e2;
            background: #e7f3ff;
            border-radius: 6px;
            padding: 8px;
        }

        /* ê²°ê³¼ í…Œì´ë¸” */
        .results-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .results-table th,
        .results-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .results-table th {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .results-table .rank-1 {
            background: #fff3cd;
            color: #856404;
            font-weight: 700;
        }

        .results-table .rank-2 {
            background: #e2e3e5;
            color: #495057;
            font-weight: 600;
        }

        .results-table .rank-3 {
            background: #f4cccc;
            color: #721c24;
            font-weight: 600;
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4a90e2;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #4a90e2;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #6c757d;
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .students-table,
            .results-table {
                font-size: 0.8rem;
            }

            .students-table th,
            .students-table td,
            .results-table th,
            .results-table td {
                padding: 8px 4px;
            }

            .game-select {
                width: 70px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .control-panel {
                padding: 20px;
            }

            .control-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .tab-content {
                padding: 15px;
            }

            .class-form {
                padding: 15px;
            }

            .students-table,
            .results-table {
                font-size: 0.7rem;
            }

            .students-table th,
            .students-table td,
            .results-table th,
            .results-table td {
                padding: 6px 2px;
            }

            .student-name-input {
                font-size: 0.8rem;
                padding: 6px 8px;
            }

            .game-select {
                width: 60px;
                font-size: 0.7rem;
                padding: 4px;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .nav-tab {
                flex: none;
                min-width: 100px;
                padding: 12px 15px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .students-table,
            .results-table {
                font-size: 0.65rem;
            }

            .btn {
                font-size: 0.9rem;
                padding: 10px 18px;
            }

            .stat-number {
                font-size: 2rem;
            }
        }

        /* í…Œì´ë¸” ìŠ¤í¬ë¡¤ */
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            border-radius: 10px;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸ† ë¦¬ê·¸ì „ ê²½ê¸° ê²°ê³¼ ê´€ë¦¬</h1>
            <p>ê° ë°˜ë³„ í•™ìƒë“¤ì˜ ê²½ê¸° ê²°ê³¼ë¥¼ ì…ë ¥í•˜ê³  ìŠ¹ì ì„ í™•ì¸í•´ë³´ì„¸ìš”!</p>
        </header>

        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="control-panel">
            <div class="control-grid">
                <div class="control-group">
                    <label>ì „ì²´ ë°˜ ìˆ˜</label>
                    <select id="totalClasses">
                        <option value="4">4ê°œ ë°˜</option>
                        <option value="6">6ê°œ ë°˜</option>
                        <option value="8" selected>8ê°œ ë°˜</option>
                    </select>
                </div>
                <div class="control-group">
                    <button class="btn btn-primary" id="calculateBtn">ğŸ“Š ìŠ¹ì  ê³„ì‚°</button>
                </div>
                <div class="control-group">
                    <button class="btn btn-success" id="exportCsvBtn">ğŸ“ CSV ë‹¤ìš´ë¡œë“œ</button>
                </div>
                <div class="control-group">
                    <button class="btn btn-warning" id="saveDataBtn">ğŸ’¾ ë°ì´í„° ì €ì¥</button>
                </div>
                <div class="control-group">
                    <button class="btn btn-warning" id="loadDataBtn">ğŸ“‚ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
                <div class="control-group">
                    <button class="btn btn-danger" id="resetBtn">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
        <nav class="nav-tabs" id="navTabs">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </nav>

        <!-- íƒ­ ì»¨í…ì¸  -->
        <div id="tabContents">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>

        <!-- ì „ì²´ ê²°ê³¼ íƒ­ -->
        <div class="tab-content" id="resultsTab">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalStudents">0</div>
                    <div class="stat-label">ì „ì²´ í•™ìƒ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgPoints">0</div>
                    <div class="stat-label">í‰ê·  ìŠ¹ì </div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedGames">0</div>
                    <div class="stat-label">ì™„ë£Œëœ ê²½ê¸°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="participationRate">0%</div>
                    <div class="stat-label">ì°¸ê°€ìœ¨</div>
                </div>
            </div>

            <div class="results-section">
                <h3>ğŸ† ì „ì²´ ìˆœìœ„</h3>
                <div class="table-container">
                    <table class="results-table" id="resultsTable">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>ë°˜</th>
                                <th>ì´ë¦„</th>
                                <th>1ê²½ê¸°</th>
                                <th>2ê²½ê¸°</th>
                                <th>3ê²½ê¸°</th>
                                <th>4ê²½ê¸°</th>
                                <th>5ê²½ê¸°</th>
                                <th>ì´ ìŠ¹ì </th>
                                <th>ì°¸ê°€ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- ê²°ê³¼ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let classData = {};
        let totalClasses = 8;
        let studentsPerClass = 20;

        // ì ìˆ˜ ê³„ì‚° ê·œì¹™
        const POINTS = {
            win: 3,
            loss: 2,
            absent: 0
        };

        // DOM ìš”ì†Œ
        const elements = {
            totalClassesSelect: document.getElementById('totalClasses'),
            calculateBtn: document.getElementById('calculateBtn'),
            exportCsvBtn: document.getElementById('exportCsvBtn'),
            saveDataBtn: document.getElementById('saveDataBtn'),
            loadDataBtn: document.getElementById('loadDataBtn'),
            resetBtn: document.getElementById('resetBtn'),
            navTabs: document.getElementById('navTabs'),
            tabContents: document.getElementById('tabContents'),
            resultsTab: document.getElementById('resultsTab'),
            resultsTable: document.getElementById('resultsTable'),
            totalStudents: document.getElementById('totalStudents'),
            avgPoints: document.getElementById('avgPoints'),
            completedGames: document.getElementById('completedGames'),
            participationRate: document.getElementById('participationRate')
        };

        // ì´ˆê¸°í™”
        function init() {
            loadSavedData();
            setupEventListeners();
            createClassTabs();
            showTab('class1');
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            elements.totalClassesSelect.addEventListener('change', handleClassCountChange);
            elements.calculateBtn.addEventListener('click', calculateAllPoints);
            elements.exportCsvBtn.addEventListener('click', exportToCSV);
            elements.saveDataBtn.addEventListener('click', saveData);
            elements.loadDataBtn.addEventListener('click', loadData);
            elements.resetBtn.addEventListener('click', resetAllData);
        }

        // ë°˜ ìˆ˜ ë³€ê²½ ì²˜ë¦¬
        function handleClassCountChange() {
            totalClasses = parseInt(elements.totalClassesSelect.value);
            createClassTabs();
            showTab('class1');
        }

        // ë°˜ë³„ íƒ­ ìƒì„±
        function createClassTabs() {
            // ë„¤ë¹„ê²Œì´ì…˜ íƒ­ ìƒì„±
            elements.navTabs.innerHTML = '';

            for (let i = 1; i <= totalClasses; i++) {
                const tab = document.createElement('button');
                tab.className = `nav-tab ${i === 1 ? 'active' : ''}`;
                tab.textContent = `${i}ë°˜`;
                tab.onclick = () => showTab(`class${i}`);
                elements.navTabs.appendChild(tab);
            }

            // ê²°ê³¼ íƒ­ ì¶”ê°€
            const resultsTabBtn = document.createElement('button');
            resultsTabBtn.className = 'nav-tab';
            resultsTabBtn.textContent = 'ì „ì²´ ê²°ê³¼';
            resultsTabBtn.onclick = () => showTab('results');
            elements.navTabs.appendChild(resultsTabBtn);

            // íƒ­ ì»¨í…ì¸  ìƒì„±
            elements.tabContents.innerHTML = '';

            for (let i = 1; i <= totalClasses; i++) {
                const tabContent = createClassTabContent(i);
                elements.tabContents.appendChild(tabContent);

                // í´ë˜ìŠ¤ ë°ì´í„° ì´ˆê¸°í™”
                if (!classData[`class${i}`]) {
                    classData[`class${i}`] = {
                        students: Array(studentsPerClass).fill().map(() => ({
                            name: '',
                            games: ['', '', '', '', ''],
                            totalPoints: 0
                        }))
                    };
                }
            }
        }

        // ë°˜ë³„ íƒ­ ì»¨í…ì¸  ìƒì„±
        function createClassTabContent(classNum) {
            const tabContent = document.createElement('div');
            tabContent.className = `tab-content ${classNum === 1 ? 'active' : ''}`;
            tabContent.id = `class${classNum}Tab`;

            // ë°˜ë³„ ì¸ì› ìˆ˜ ì¡°ì ˆ ì»¨íŠ¸ë¡¤ ì¶”ê°€
            const classControl = document.createElement('div');
            classControl.innerHTML = `
                <div class="control-grid" style="margin-bottom: 20px;">
                    <div class="control-group">
                        <label>${classNum}ë°˜ í•™ìƒ ìˆ˜</label>
                        <select id="studentsCount${classNum}" onchange="updateStudentCount(${classNum}, this.value)">
                            ${Array.from({length: 20}, (_, i) =>
                                `<option value="${i + 1}" ${i + 1 === studentsPerClass ? 'selected' : ''}>${i + 1}ëª…</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
            `;

            const classForm = document.createElement('div');
            classForm.className = 'class-form';

            const classHeader = document.createElement('div');
            classHeader.className = 'class-header';
            classHeader.innerHTML = `
                <h2 class="class-title">${classNum}ë°˜</h2>
                <span class="student-count" id="studentCount${classNum}">${studentsPerClass}ëª…</span>
            `;

            const tableContainer = document.createElement('div');
            tableContainer.className = 'table-container';

            const table = document.createElement('table');
            table.className = 'students-table';
            table.id = `studentsTable${classNum}`;

            // í…Œì´ë¸” í—¤ë”
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th style="width: 120px;">í•™ìƒ ì´ë¦„</th>
                    <th style="width: 90px;">1ê²½ê¸°</th>
                    <th style="width: 90px;">2ê²½ê¸°</th>
                    <th style="width: 90px;">3ê²½ê¸°</th>
                    <th style="width: 90px;">4ê²½ê¸°</th>
                    <th style="width: 90px;">5ê²½ê¸°</th>
                    <th style="width: 100px;">ì´ ìŠ¹ì </th>
                </tr>
            `;

            // í…Œì´ë¸” ë°”ë””
            const tbody = document.createElement('tbody');
            tbody.id = `studentsTableBody${classNum}`;

            table.appendChild(thead);
            table.appendChild(tbody);
            tableContainer.appendChild(table);

            classForm.appendChild(classHeader);
            classForm.appendChild(tableContainer);

            tabContent.appendChild(classControl);
            tabContent.appendChild(classForm);

            // í•™ìƒ í–‰ ìƒì„±
            updateStudentRows(classNum);

            return tabContent;
        }

        // í•™ìƒ ìˆ˜ ì—…ë°ì´íŠ¸
        function updateStudentCount(classNum, count) {
            const currentCount = classData[`class${classNum}`].students.length;
            const newCount = parseInt(count);

            if (newCount > currentCount) {
                // í•™ìƒ ì¶”ê°€
                for (let i = currentCount; i < newCount; i++) {
                    classData[`class${classNum}`].students.push({
                        name: '',
                        games: ['', '', '', '', ''],
                        totalPoints: 0
                    });
                }
            } else if (newCount < currentCount) {
                // í•™ìƒ ì œê±°
                classData[`class${classNum}`].students = classData[`class${classNum}`].students.slice(0, newCount);
            }

            document.getElementById(`studentCount${classNum}`).textContent = `${newCount}ëª…`;
            updateStudentRows(classNum);
        }

        // í•™ìƒ í–‰ ì—…ë°ì´íŠ¸
        function updateStudentRows(classNum) {
            const tbody = document.getElementById(`studentsTableBody${classNum}`);
            tbody.innerHTML = '';

            classData[`class${classNum}`].students.forEach((student, index) => {
                const row = document.createElement('tr');

                // ì´ë¦„ ì…ë ¥
                const nameCell = document.createElement('td');
                nameCell.innerHTML = `
                    <input
                        type="text"
                        class="student-name-input"
                        placeholder="í•™ìƒ ì´ë¦„"
                        value="${student.name}"
                        onchange="updateStudentName('class${classNum}', ${index}, this.value)"
                    >
                `;

                // ê²Œì„ ê²°ê³¼ ì„ íƒ
                const gameCells = [];
                for (let i = 0; i < 5; i++) {
                    const gameCell = document.createElement('td');
                    gameCell.innerHTML = `
                        <select
                            class="game-select ${getGameResultClass(student.games[i])}"
                            onchange="updateGameResult('class${classNum}', ${index}, ${i}, this.value)"
                        >
                            <option value="">-</option>
                            <option value="win" ${student.games[i] === 'win' ? 'selected' : ''}>ìŠ¹</option>
                            <option value="loss" ${student.games[i] === 'loss' ? 'selected' : ''}>íŒ¨</option>
                            <option value="absent" ${student.games[i] === 'absent' ? 'selected' : ''}>ë¶ˆì°¸</option>
                        </select>
                    `;
                    gameCells.push(gameCell);
                }

                // ì´ ìŠ¹ì 
                const totalCell = document.createElement('td');
                totalCell.innerHTML = `<div class="total-points">${student.totalPoints}</div>`;

                row.appendChild(nameCell);
                gameCells.forEach(cell => row.appendChild(cell));
                row.appendChild(totalCell);

                tbody.appendChild(row);
            });
        }

        // ê²Œì„ ê²°ê³¼ì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜
        function getGameResultClass(result) {
            switch(result) {
                case 'win': return 'win';
                case 'loss': return 'loss';
                case 'absent': return 'absent';
                default: return '';
            }
        }

        // í•™ìƒ ì´ë¦„ ì—…ë°ì´íŠ¸
        function updateStudentName(classKey, studentIndex, name) {
            classData[classKey].students[studentIndex].name = name;
        }

        // ê²Œì„ ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateGameResult(classKey, studentIndex, gameIndex, result) {
            classData[classKey].students[studentIndex].games[gameIndex] = result;

            // ì„ íƒ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            const selectElement = event.target;
            selectElement.className = `game-select ${getGameResultClass(result)}`;

            // ê°œë³„ í•™ìƒ ìŠ¹ì  ê³„ì‚°
            calculateStudentPoints(classKey, studentIndex);
        }

        // ê°œë³„ í•™ìƒ ìŠ¹ì  ê³„ì‚°
        function calculateStudentPoints(classKey, studentIndex) {
            const student = classData[classKey].students[studentIndex];
            let totalPoints = 0;

            student.games.forEach(result => {
                if (POINTS[result]) {
                    totalPoints += POINTS[result];
                }
            });

            student.totalPoints = totalPoints;

            // UI ì—…ë°ì´íŠ¸
            const classNum = classKey.replace('class', '');
            const tbody = document.getElementById(`studentsTableBody${classNum}`);
            const row = tbody.children[studentIndex];
            const totalCell = row.lastElementChild;
            totalCell.innerHTML = `<div class="total-points">${totalPoints}</div>`;
        }

        // ì „ì²´ ìŠ¹ì  ê³„ì‚°
        function calculateAllPoints() {
            elements.calculateBtn.innerHTML = '<span class="loading"></span>ê³„ì‚° ì¤‘...';
            elements.calculateBtn.disabled = true;

            setTimeout(() => {
                // ëª¨ë“  í•™ìƒì˜ ìŠ¹ì  ê³„ì‚°
                Object.keys(classData).forEach(classKey => {
                    classData[classKey].students.forEach((student, index) => {
                        calculateStudentPoints(classKey, index);
                    });
                });

                // ê²°ê³¼ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateResultsTable();

                // í†µê³„ ì—…ë°ì´íŠ¸
                updateStats();

                elements.calculateBtn.innerHTML = 'ğŸ“Š ìŠ¹ì  ê³„ì‚°';
                elements.calculateBtn.disabled = false;

                // ì„±ê³µ ì•Œë¦¼
                showAlert('ìŠ¹ì  ê³„ì‚°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }, 1000);
        }

        // ê²°ê³¼ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateResultsTable() {
            const tbody = elements.resultsTable.querySelector('tbody');
            tbody.innerHTML = '';

            // ëª¨ë“  í•™ìƒ ë°ì´í„° ìˆ˜ì§‘
            const allStudents = [];
            Object.keys(classData).forEach(classKey => {
                const classNum = classKey.replace('class', '');
                classData[classKey].students.forEach(student => {
                    if (student.name.trim() !== '') {
                        allStudents.push({
                            ...student,
                            class: classNum,
                            participationRate: calculateParticipationRate(student.games)
                        });
                    }
                });
            });

            // ìŠ¹ì  ìˆœìœ¼ë¡œ ì •ë ¬
            allStudents.sort((a, b) => {
                if (b.totalPoints !== a.totalPoints) {
                    return b.totalPoints - a.totalPoints;
                }
                return b.participationRate - a.participationRate;
            });

            // í…Œì´ë¸” í–‰ ìƒì„±
            allStudents.forEach((student, index) => {
                const row = document.createElement('tr');

                // ìˆœìœ„ì— ë”°ë¥¸ í´ë˜ìŠ¤ ì¶”ê°€
                if (index === 0) row.classList.add('rank-1');
                else if (index === 1) row.classList.add('rank-2');
                else if (index === 2) row.classList.add('rank-3');

                row.innerHTML = `
                    <td><strong>${index + 1}</strong></td>
                    <td>${student.class}ë°˜</td>
                    <td><strong>${student.name}</strong></td>
                    <td>${getResultDisplay(student.games[0])}</td>
                    <td>${getResultDisplay(student.games[1])}</td>
                    <td>${getResultDisplay(student.games[2])}</td>
                    <td>${getResultDisplay(student.games[3])}</td>
                    <td>${getResultDisplay(student.games[4])}</td>
                    <td><strong style="color: #4a90e2;">${student.totalPoints}</strong></td>
                    <td>${student.participationRate}%</td>
                `;

                tbody.appendChild(row);
            });
        }

        // ê²°ê³¼ í‘œì‹œ í˜•ì‹
        function getResultDisplay(result) {
            switch(result) {
                case 'win': return '<span style="color: #28a745;">ìŠ¹</span>';
                case 'loss': return '<span style="color: #ffc107;">íŒ¨</span>';
                case 'absent': return '<span style="color: #dc3545;">ë¶ˆì°¸</span>';
                default: return '-';
            }
        }

        // ì°¸ê°€ìœ¨ ê³„ì‚°
        function calculateParticipationRate(games) {
            const playedGames = games.filter(game => game !== '' && game !== 'absent').length;
            return Math.round((playedGames / 5) * 100);
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const allStudents = [];
            let totalGames = 0;
            let totalPoints = 0;
            let totalParticipation = 0;

            Object.keys(classData).forEach(classKey => {
                classData[classKey].students.forEach(student => {
                    if (student.name.trim() !== '') {
                        allStudents.push(student);
                        totalPoints += student.totalPoints;

                        student.games.forEach(game => {
                            if (game !== '' && game !== 'absent') {
                                totalGames++;
                                totalParticipation++;
                            } else if (game === 'absent') {
                                totalGames++;
                            }
                        });
                    }
                });
            });

            elements.totalStudents.textContent = allStudents.length;
            elements.avgPoints.textContent = allStudents.length > 0 ? Math.round(totalPoints / allStudents.length * 10) / 10 : 0;
            elements.completedGames.textContent = totalGames;
            elements.participationRate.textContent = totalGames > 0 ? Math.round((totalParticipation / totalGames) * 100) : 0;
        }

        // íƒ­ í‘œì‹œ
        function showTab(tabId) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            if (tabId === 'results') {
                document.querySelector('.nav-tab:last-child').classList.add('active');
                elements.resultsTab.classList.add('active');
                updateResultsTable();
                updateStats();
            } else {
                const tabButton = Array.from(elements.navTabs.children).find(tab =>
                    tab.textContent === tabId.replace('class', '') + 'ë°˜'
                );
                if (tabButton) tabButton.classList.add('active');

                const tabContent = document.getElementById(tabId + 'Tab');
                if (tabContent) tabContent.classList.add('active');
            }
        }

        // CSV ë‚´ë³´ë‚´ê¸°
        function exportToCSV() {
            const allStudents = [];

            Object.keys(classData).forEach(classKey => {
                const classNum = classKey.replace('class', '');
                classData[classKey].students.forEach(student => {
                    if (student.name.trim() !== '') {
                        allStudents.push({
                            class: classNum,
                            name: student.name,
                            game1: student.games[0] || '-',
                            game2: student.games[1] || '-',
                            game3: student.games[2] || '-',
                            game4: student.games[3] || '-',
                            game5: student.games[4] || '-',
                            totalPoints: student.totalPoints,
                            participationRate: calculateParticipationRate(student.games)
                        });
                    }
                });
            });

            // ìŠ¹ì  ìˆœ ì •ë ¬
            allStudents.sort((a, b) => b.totalPoints - a.totalPoints);

            // CSV ë°ì´í„° ìƒì„±
            const csvData = [
                ['ìˆœìœ„', 'ë°˜', 'ì´ë¦„', '1ê²½ê¸°', '2ê²½ê¸°', '3ê²½ê¸°', '4ê²½ê¸°', '5ê²½ê¸°', 'ì´ìŠ¹ì ', 'ì°¸ê°€ìœ¨'],
                ...allStudents.map((student, index) => [
                    index + 1,
                    student.class + 'ë°˜',
                    student.name,
                    student.game1,
                    student.game2,
                    student.game3,
                    student.game4,
                    student.game5,
                    student.totalPoints,
                    student.participationRate + '%'
                ])
            ];

            // CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', `ë¦¬ê·¸ì „ê²°ê³¼_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showAlert('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            try {
                localStorage.setItem('leagueData', JSON.stringify({
                    classData: classData,
                    totalClasses: totalClasses,
                    timestamp: new Date().toISOString()
                }));
                showAlert('ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            } catch (error) {
                showAlert('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadData() {
            try {
                const savedData = localStorage.getItem('leagueData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    classData = data.classData;
                    totalClasses = data.totalClasses;

                    elements.totalClassesSelect.value = totalClasses;
                    createClassTabs();
                    showTab('class1');

                    showAlert('ë°ì´í„°ê°€ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤!', 'success');
                } else {
                    showAlert('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }
            } catch (error) {
                showAlert('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ì €ì¥ëœ ë°ì´í„° ë¡œë“œ (ì´ˆê¸°í™” ì‹œ)
        function loadSavedData() {
            const savedData = localStorage.getItem('leagueData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    classData = data.classData || {};
                    totalClasses = data.totalClasses || 8;
                    elements.totalClassesSelect.value = totalClasses;
                } catch (error) {
                    console.error('ì €ì¥ëœ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }
        }

        // ì „ì²´ ì´ˆê¸°í™”
        function resetAllData() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                classData = {};
                localStorage.removeItem('leagueData');
                createClassTabs();
                showTab('class1');
                showAlert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            document.querySelector('.control-panel').appendChild(alertDiv);

            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }

        // ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ
        window.updateStudentCount = updateStudentCount;
        window.updateStudentName = updateStudentName;
        window.updateGameResult = updateGameResult;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>