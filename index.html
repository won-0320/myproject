<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>리그전 점수 관리 (최종)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap">
<style>
  :root{--bg:#f6f8fb;--card:#fff;--accent:#2563eb;--muted:#6b7280}
  *{box-sizing:border-box}
  body{font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#111;margin:0;background:var(--bg)}
  header{background:linear-gradient(90deg,#06b6d4,#2563eb);color:#fff;padding:18px}
  .wrap{max-width:1100px;margin:18px auto;padding:12px}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:16px}
  .card{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 2px 8px rgba(16,24,40,0.06)}
  label{display:block;margin:8px 0 4px;font-weight:600}
  select,input,button,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6edf3}
  .btn{display:inline-block;padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid #ddd;color:#111;cursor:pointer}
  .small{font-size:0.9rem;color:var(--muted)}
  table{width:100%;border-collapse:collapse;margin-top:8px;font-size:0.9rem}
  th,td{padding:6px;border:1px solid #eef2f6;text-align:center}
  thead th{background:#fafafa}
  .responsive{overflow:auto}
  .modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.4);justify-content:center;align-items:center}
  .modal .modal-content{background:#fff;padding:18px;border-radius:10px;min-width:280px}
  @media (max-width:920px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1 style="margin:0;font-size:1.1rem">리그전 점수 관리 — 최종 통합판</h1>
    <div class="small" style="margin-top:6px">8반, 반별 학생수 조절(1~20), 학생별 비밀번호, 교사 인증/비밀번호 변경, CSV/PDF, localStorage</div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section>
      <div class="card">
        <h2>학생 입력</h2>
        <div class="small">반과 학생을 선택하고, 학생 비밀번호 입력 후 5게임 결과를 저장하세요. 교사 모드에서는 비밀번호 없이 저장됩니다.</div>

        <label>반 선택</label>
        <select id="inputClassSelect"></select>

        <div style="display:flex;gap:8px;margin-top:8px">
          <div style="flex:1">
            <label>학생 선택</label>
            <select id="studentSelectForInput"></select>
          </div>
          <div style="width:160px">
            <label>학생 수 (1~20)</label>
            <input id="studentCountInput" type="number" min="1" max="20" />
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="applyStudentCountBtn" class="btn">학생수 적용</button>
          <button id="autoFillNamesBtn" class="btn-ghost">자동 채우기</button>
          <button id="clearClassBtn" class="btn-ghost">반 초기화</button>
        </div>

        <div style="margin-top:10px">
          <label>학생 비밀번호</label>
          <input id="studentPasswordInput" type="password" placeholder="학생 비밀번호 입력" />
        </div>

        <div id="gameInputsWrap" style="margin-top:10px"></div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="saveStudentResultBtn" class="btn">저장</button>
          <button id="deleteStudentBtn" class="btn-ghost">학생 삭제</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h2>데이터 관리</h2>
        <div class="small">저장/불러오기, 내보내기, 전체 초기화</div>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button id="saveAllBtn" class="btn">로컬에 저장</button>
          <button id="loadAllBtn" class="btn-ghost">로컬 불러오기</button>
          <button id="exportCsvBtn" class="btn">CSV 내보내기</button>
          <button id="exportPdfBtn" class="btn">PDF 내보내기</button>
          <button id="resetAllBtn" class="btn-ghost">초기화 (전체)</button>
        </div>
      </div>
    </section>

    <aside>
      <div class="card">
        <h2>요약 & 교사 기능</h2>
        <div class="small">교사 로그인하면 전체관리(비밀번호 변경/초기화/다운로드 등)가 가능합니다.</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="openTeacherLoginBtn" class="btn">교사 로그인</button>
          <button id="calcAllBtn" class="btn-ghost">승점 계산</button>
          <button id="refreshViewBtn" class="btn-ghost">뷰 새로고침</button>
        </div>

        <div id="teacherArea" class="teacher-only" style="display:none;margin-top:12px">
          <h3>교사 전용</h3>
          <div style="display:flex;gap:8px;align-items:end">
            <div style="flex:1">
              <label>비밀번호 리셋 - 반 선택</label>
              <select id="resetClassSelect"></select>
            </div>
            <div style="flex:1">
              <label>학생 선택</label>
              <select id="resetStudentSelect"></select>
            </div>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="resetStudentPwdBtn" class="btn">비밀번호 초기화</button>
            <button id="resetStudentPwdCustomBtn" class="btn-ghost">비밀번호 직접설정</button>
          </div>

          <div style="margin-top:12px">
            <h4>교사 비밀번호 변경</h4>
            <input id="newTeacherPw" type="password" placeholder="새 비밀번호 입력" />
            <button id="changeTeacherPwBtn" class="btn" style="margin-top:8px">변경</button>
          </div>
        </div>

      </div>

      <div class="card" style="margin-top:12px">
        <h2>결과 확인</h2>
        <div class="small">모든 반의 학생 결과를 반별로 순위 정렬하여 보여줍니다.</div>
        <div id="resultsWrap" class="responsive" style="margin-top:10px;max-height:560px;overflow:auto"></div>
      </div>
    </aside>
  </div>
</main>

<!-- 교사 로그인 모달 -->
<div id="teacherLoginModal" class="modal"><div class="modal-content">
  <h3>교사 인증</h3>
  <input id="teacherPasswordInput" type="password" placeholder="교사 비밀번호 입력" />
  <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
    <button id="teacherLoginOkBtn" class="btn">확인</button>
    <button id="teacherLoginCancelBtn" class="btn-ghost">취소</button>
  </div>
</div></div>

<!-- 비밀번호 직접 설정 모달 -->
<div id="customPwdModal" class="modal"><div class="modal-content">
  <h3>새 비밀번호 설정 (교사 전용)</h3>
  <div id="customPwdInfo" class="small" style="margin-bottom:8px"></div>
  <input id="customPwdInput" type="text" placeholder="새 비밀번호 입력" />
  <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
    <button id="customPwdOkBtn" class="btn">설정</button>
    <button id="customPwdCancelBtn" class="btn-ghost">취소</button>
  </div>
</div></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
/* ====== 전역 설정 ====== */
const SCORE = { '승':3, '패':2, '불참':0 };
let teacherMode = false;
let TEACHER_PASSWORD = localStorage.getItem('teacherPassword') || 'teacher123';
const LS_KEY = 'league_scores_v2';

/* ====== 데이터 구조 ======
classes = [
  { name: '반1', students: [{name, results:[...], total, password, lastSaved}, ...] },
  ...
]
==========================*/

let classes = [];

/* 초기 생성 (8반, 기본 20명) */
function initClasses(){
  classes = [];
  for(let c=1;c<=8;c++){
    const students = [];
    for(let i=0;i<20;i++){
      students.push({
        name: `학생${i+1}`,
        results: ['불참','불참','불참','불참','불참'],
        total: 0,
        password: `stu${i+1}`,
        lastSaved: null
      });
    }
    classes.push({ name: `반${c}`, students });
  }
  saveLocal();
}

/* 로컬 로드/저장 */
function loadLocal(){
  const raw = localStorage.getItem(LS_KEY);
  if(raw){
    try { classes = JSON.parse(raw); } catch(e){ initClasses(); }
  } else initClasses();
}
function saveLocal(){ localStorage.setItem(LS_KEY, JSON.stringify(classes)); }

/* 초기화 실행 */
loadLocal();

/* ====== UI 채우기: 반 선택 / 학생 선택 / 학생수 ====== */
const inputClassSelect = document.getElementById('inputClassSelect');
const studentSelectForInput = document.getElementById('studentSelectForInput');
const studentCountInput = document.getElementById('studentCountInput');
const gameInputsWrap = document.getElementById('gameInputsWrap');
const resultsWrap = document.getElementById('resultsWrap');

function renderClassSelectors(){
  inputClassSelect.innerHTML = classes.map((c,i)=>`<option value="${i}">${c.name}</option>`).join('');
  populateStudentSelect(0);
  studentCountInput.value = classes[0].students.length;
}
function populateStudentSelect(classIdx){
  const students = classes[classIdx].students;
  studentSelectForInput.innerHTML = students.map((s,i)=>`<option value="${i}">${i+1}. ${escapeHtml(s.name)}</option>`).join('');
}

/* 학생수 적용 (반별) */
function applyStudentCount(){
  const classIdx = Number(inputClassSelect.value || 0);
  let count = Number(studentCountInput.value) || 1;
  if(count < 1) count = 1;
  if(count > 20) count = 20;
  const students = classes[classIdx].students;
  if(count > students.length){
    for(let i=students.length;i<count;i++){
      students.push({
        name: `학생${i+1}`,
        results: ['불참','불참','불참','불참','불참'],
        total: 0,
        password: `stu${i+1}`,
        lastSaved: null
      });
    }
  } else if(count < students.length){
    students.splice(count);
  }
  saveLocal();
  populateStudentSelect(classIdx);
  updateGameInputs(classIdx, 0);
  renderSummary();
}

/* 자동 채우기 (학생명 기본) */
function autoFillNames(){
  const classIdx = Number(inputClassSelect.value || 0);
  const count = classes[classIdx].students.length;
  classes[classIdx].students = Array.from({length:count},(_,i)=>({
    name: `학생${i+1}`,
    results: ['불참','불참','불참','불참','불참'],
    total: 0,
    password: `stu${i+1}`,
    lastSaved: null
  }));
  saveLocal();
  populateStudentSelect(classIdx);
  updateGameInputs(classIdx, 0);
  renderSummary();
}

/* 반 초기화 (선택 반) */
function clearClass(){
  if(!confirm('선택한 반의 데이터를 초기화합니까?')) return;
  const classIdx = Number(inputClassSelect.value || 0);
  const size = Number(studentCountInput.value) || 1;
  classes[classIdx].students = Array.from({length:size},(_,i)=>({
    name: `학생${i+1}`,
    results: ['불참','불참','불참','불참','불참'],
    total: 0,
    password: `stu${i+1}`,
    lastSaved: null
  }));
  saveLocal();
  populateStudentSelect(classIdx);
  updateGameInputs(classIdx,0);
  renderSummary();
}

/* 학생 삭제 */
function deleteStudent(){
  const classIdx = Number(inputClassSelect.value || 0);
  const stuIdx = Number(studentSelectForInput.value || 0);
  if(!confirm('선택한 학생을 삭제합니까?')) return;
  classes[classIdx].students.splice(stuIdx,1);
  saveLocal();
  populateStudentSelect(classIdx);
  updateGameInputs(classIdx, Math.max(0, stuIdx-1));
  studentCountInput.value = classes[classIdx].students.length;
  renderSummary();
}

/* 이름/비밀번호 편집 스크린은 간단화: 교사 모드에서 CSV로 내보낸 뒤 수정 권장 */

/* ====== 경기 입력 UI 업데이트 ====== */
function updateGameInputs(classIdx, stuIdx){
  const student = classes[classIdx].students[stuIdx];
  gameInputsWrap.innerHTML = '';
  for(let i=0;i<5;i++){
    const lbl = document.createElement('label'); lbl.textContent = `게임 ${i+1}`;
    const sel = document.createElement('select'); sel.dataset.i = i;
    ['승','패','불참'].forEach(opt=>{
      const o = document.createElement('option'); o.value = opt; o.textContent = opt;
      if(student.results[i] === opt) o.selected = true;
      sel.appendChild(o);
    });
    gameInputsWrap.appendChild(lbl);
    gameInputsWrap.appendChild(sel);
  }
  const totalDiv = document.createElement('div'); totalDiv.id='studentTotalPreview'; totalDiv.style.marginTop='8px';
  gameInputsWrap.appendChild(totalDiv);
  gameInputsWrap.querySelectorAll('select').forEach(s=>s.addEventListener('change', updateStudentTotalPreview));
  updateStudentTotalPreview();
}
function updateStudentTotalPreview(){
  const selects = gameInputsWrap.querySelectorAll('select');
  let total = 0;
  selects.forEach(s=> total += SCORE[s.value] || 0);
  const div = document.getElementById('studentTotalPreview');
  if(div) div.textContent = `현재 합계: ${total}점`;
}

/* 저장 (학생) — 비밀번호 확인 필요 (교사모드면 통과) */
document.getElementById('saveStudentResultBtn').addEventListener('click', ()=>{
  const classIdx = Number(inputClassSelect.value || 0);
  const stuIdx = Number(studentSelectForInput.value || 0);
  const pwInput = document.getElementById('studentPasswordInput').value || '';
  const student = classes[classIdx].students[stuIdx];
  if(!teacherMode && pwInput !== student.password){
    alert('비밀번호가 틀렸습니다.');
    return;
  }
  const selects = gameInputsWrap.querySelectorAll('select');
  const results = Array.from(selects).map(s=>s.value);
  student.results = results;
  student.total = results.reduce((acc,v)=>acc + (SCORE[v]||0), 0);
  student.lastSaved = new Date().toISOString();
  saveLocal();
  renderSummary();
  alert('저장되었습니다.');
});

/* ====== 교사 로그인/모드 ====== */
const openTeacherLoginBtn = document.getElementById('openTeacherLoginBtn');
const teacherLoginModal = document.getElementById('teacherLoginModal');
openTeacherLoginBtn.addEventListener('click', ()=>{ teacherLoginModal.style.display='flex'; });

document.getElementById('teacherLoginCancelBtn').addEventListener('click', ()=>{ teacherLoginModal.style.display='none'; });
document.getElementById('teacherLoginOkBtn').addEventListener('click', ()=>{
  const val = document.getElementById('teacherPasswordInput').value || '';
  if(val === TEACHER_PASSWORD){
    teacherMode = true;
    teacherLoginModal.style.display='none';
    document.querySelectorAll('.teacher-only').forEach(e=>e.style.display='block');
    populateResetSelectors();
    alert('교사 인증 성공 — 교사 모드 활성화');
  } else alert('비밀번호가 틀렸습니다.');
});

/* 교사 비밀번호 변경 */
document.getElementById('changeTeacherPwBtn').addEventListener('click', ()=>{
  if(!teacherMode){ alert('교사로 로그인해야 합니다.'); return; }
  const newPw = document.getElementById('newTeacherPw').value.trim();
  if(!newPw){ alert('새 비밀번호를 입력하세요.'); return; }
  TEACHER_PASSWORD = newPw;
  localStorage.setItem('teacherPassword', newPw);
  document.getElementById('newTeacherPw').value = '';
  alert('교사 비밀번호가 변경되었습니다.');
});

/* ====== 교사: 학생 비밀번호 초기화 ====== */
function populateResetSelectors(){
  const resetClassSelect = document.getElementById('resetClassSelect');
  const resetStudentSelect = document.getElementById('resetStudentSelect');
  resetClassSelect.innerHTML = classes.map((c,i)=>`<option value="${i}">${c.name}</option>`).join('');
  resetStudentSelect.innerHTML = classes[0].students.map((s,i)=>`<option value="${i}">${i+1}. ${escapeHtml(s.name)}</option>`).join('');
  resetClassSelect.addEventListener('change', ()=>{
    const idx = Number(resetClassSelect.value || 0);
    resetStudentSelect.innerHTML = classes[idx].students.map((s,i)=>`<option value="${i}">${i+1}. ${escapeHtml(s.name)}</option>`).join('');
  });
}
document.getElementById('resetStudentPwdBtn').addEventListener('click', ()=>{
  if(!teacherMode){ alert('교사로 로그인해야 합니다.'); return; }
  const classIdx = Number(document.getElementById('resetClassSelect').value || 0);
  const stuIdx = Number(document.getElementById('resetStudentSelect').value || 0);
  const student = classes[classIdx].students[stuIdx];
  const newPw = `stu${stuIdx+1}`;
  student.password = newPw;
  saveLocal();
  alert(`${student.name} 비밀번호가 초기화되었습니다.\n새 비밀번호: ${newPw}`);
});

/* 교사가 직접 비밀번호 지정 */
const customPwdModal = document.getElementById('customPwdModal');
document.getElementById('resetStudentPwdCustomBtn').addEventListener('click', ()=>{
  if(!teacherMode){ alert('교사로 로그인해야 합니다.'); return; }
  const classIdx = Number(document.getElementById('resetClassSelect').value || 0);
  const stuIdx = Number(document.getElementById('resetStudentSelect').value || 0);
  const student = classes[classIdx].students[stuIdx];
  document.getElementById('customPwdInfo').textContent = `${student.name} 의 비밀번호를 설정합니다.`;
  document.getElementById('customPwdInput').value = '';
  customPwdModal.style.display = 'flex';
});
document.getElementById('customPwdCancelBtn').addEventListener('click', ()=>{ customPwdModal.style.display='none'; });
document.getElementById('customPwdOkBtn').addEventListener('click', ()=>{
  const classIdx = Number(document.getElementById('resetClassSelect').value || 0);
  const stuIdx = Number(document.getElementById('resetStudentSelect').value || 0);
  const newPw = document.getElementById('customPwdInput').value.trim();
  if(!newPw){ alert('비밀번호를 입력하세요.'); return; }
  classes[classIdx].students[stuIdx].password = newPw;
  saveLocal();
  customPwdModal.style.display = 'none';
  alert('비밀번호가 설정되었습니다.');
});

/* ====== 계산 / 정렬 / 표시 ====== */
function calculateAll(){
  classes.forEach(c=>{
    c.students.forEach(s=>{
      s.total = (s.results || ['불참','불참','불참','불참','불참']).reduce((acc,v)=>acc + (SCORE[v]||0), 0);
    });
  });
  saveLocal();
  renderSummary();
  alert('승점 계산 완료');
}

/* 렌더: 반별로 정렬된 테이블 + 전체 테이블 */
function renderSummary(){
  let out = '';
  classes.forEach((c,ci)=>{
    const sorted = c.students.map((s,idx)=>({...s, idx})).sort((a,b)=> (b.total||0) - (a.total||0));
    out += `<div style="margin-bottom:14px"><h4 style="margin:6px 0">${escapeHtml(c.name)} — 인원 ${c.students.length}</h4>`;
    out += '<div style="overflow:auto"><table><thead><tr><th>순위</th><th>이름</th><th>게임1</th><th>게임2</th><th>게임3</th><th>게임4</th><th>게임5</th><th>총점</th></tr></thead><tbody>';
    sorted.forEach((s,i)=>{
      out += `<tr><td>${i+1}</td><td>${escapeHtml(s.name)}</td>`;
      for(let k=0;k<5;k++) out += `<td>${s.results && s.results[k] ? s.results[k] : '불참'}</td>`;
      out += `<td>${s.total || 0}</td></tr>`;
    });
    out += '</tbody></table></div></div>';
  });

  // 통합 리스트 (간단)
  out += `<div style="margin-top:8px"><h4 style="margin:6px 0">전체 학생 목록</h4><div style="overflow:auto"><table><thead><tr><th>반</th><th>이름</th><th>G1</th><th>G2</th><th>G3</th><th>G4</th><th>G5</th><th>총점</th></tr></thead><tbody>`;
  classes.forEach(c=>{
    c.students.forEach(s=>{
      out += `<tr><td>${escapeHtml(c.name)}</td><td>${escapeHtml(s.name)}</td>${(s.results||['','','','','']).map(r=>`<td>${r}</td>`).join('')}<td>${s.total||0}</td></tr>`;
    });
  });
  out += '</tbody></table></div></div>';

  resultsWrap.innerHTML = out;
}

/* ====== 내보내기: CSV, PDF ====== */
function exportCSV(){
  const rows = [['반','이름','게임1','게임2','게임3','게임4','게임5','총점']];
  classes.forEach(c=>{
    c.students.forEach(s=>{
      rows.push([c.name, s.name, ...(s.results || ['불참','불참','불참','불참','불참']), s.total||0]);
    });
  });
  const csv = rows.map(r=> r.map(cell=> `"${String(cell).replace(/"/g,'""')}"`).join(',') ).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'league_scores_export.csv'; a.click(); URL.revokeObjectURL(url);
}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'pt', format:'a4'});
  const margin = 40; let y = 40; const lineHeight = 12;
  doc.setFontSize(12); doc.text('리그전 승점 결과', margin, y); y += 18;
  classes.forEach(c=>{
    doc.setFontSize(10); doc.text(`${c.name} (인원 ${c.students.length})`, margin, y); y += 14;
    doc.setFontSize(9);
    const headers = ['순','이름','G1','G2','G3','G4','G5','총'];
    doc.text(headers.join(' | '), margin, y); y += lineHeight;
    const sorted = c.students.map((s,i)=>({...s, idx:i})).sort((a,b)=> (b.total||0) - (a.total||0));
    sorted.forEach((s,si)=>{
      const row = [String(si+1), s.name, ...(s.results || ['','','','','']), String(s.total||0)];
      doc.text(row.join(' | '), margin, y); y += lineHeight;
      if(y > doc.internal.pageSize.height - margin){ doc.addPage(); y = margin; }
    });
    y += 8;
    if(y > doc.internal.pageSize.height - margin){ doc.addPage(); y = margin; }
  });
  doc.save('league_scores.pdf');
}

/* ====== 초기화 전체 ====== */
function resetAll(){
  if(!confirm('정말로 모든 데이터를 초기화합니까? (복구 불가)')) return;
  initClasses();
  TEACHER_PASSWORD = 'teacher123';
  localStorage.removeItem('teacherPassword');
  saveLocal();
  renderClassSelectors();
  renderSummary();
  alert('초기화 완료. 교사 비밀번호는 초기값 "teacher123"으로 복원되었습니다.');
}

/* ====== 헬퍼 ====== */
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ====== 이벤트 바인딩 & 초기 렌더 ====== */
document.getElementById('applyStudentCountBtn').addEventListener('click', applyStudentCount);
document.getElementById('autoFillNamesBtn').addEventListener('click', autoFillNames);
document.getElementById('clearClassBtn').addEventListener('click', clearClass);
document.getElementById('deleteStudentBtn').addEventListener('click', deleteStudent);
document.getElementById('saveAllBtn').addEventListener('click', ()=>{ saveLocal(); alert('로컬에 저장되었습니다.'); });
document.getElementById('loadAllBtn').addEventListener('click', ()=>{ loadLocal(); renderClassSelectors(); renderSummary(); alert('로컬에서 불러왔습니다.'); });
document.getElementById('exportCsvBtn').addEventListener('click', exportCSV);
document.getElementById('exportPdfBtn').addEventListener('click', exportPDF);
document.getElementById('resetAllBtn').addEventListener('click', resetAll);
document.getElementById('calcAllBtn').addEventListener('click', calculateAll);
document.getElementById('refreshViewBtn').addEventListener('click', renderSummary);

/* 반/학생 셀렉트 변경시 UI 업데이트 */
inputClassSelect.addEventListener('change', ()=>{
  const idx = Number(inputClassSelect.value || 0);
  populateStudentSelect(idx);
  studentCountInput.value = classes[idx].students.length;
  updateGameInputs(idx, 0);
});
studentSelectForInput.addEventListener('change', ()=>{
  updateGameInputs(Number(inputClassSelect.value || 0), Number(studentSelectForInput.value || 0));
});

/* 페이지 로드 초기화 */
function renderClassSelectors(){
  inputClassSelect.innerHTML = classes.map((c,i)=>`<option value="${i}">${c.name}</option>`).join('');
  const idx = Number(inputClassSelect.value || 0);
  populateStudentSelect(idx);
  studentCountInput.value = classes[idx].students.length;
  updateGameInputs(idx, Number(studentSelectForInput.value || 0));
  populateResetSelectors();
}
renderClassSelectors();
renderSummary();

</script>
</body>
</html>